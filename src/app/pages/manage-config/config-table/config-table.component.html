<app-breadcrumb nz-row [listBreadCrumb]="breadcrumbs"></app-breadcrumb>
<nz-card
  style="height: 100%; border-radius: 4px; padding-top: 10px;"
  class="color-border"
>
  <h2 style="font-weight: 600; margin-bottom: 0; text-align: center;">{{ 'QUẢN LÝ CẤU HÌNH' | translate }}</h2>
  <div nz-row nzGutter="24" nzAlign="bottom" nzJustify="space-between" class="mt-12">
    <div style="padding-left: 14px;padding-bottom: 14px; width: 35%;">
      <!-- <h4>{{ "generalSearch" | translate }}</h4> -->
      <!-- <nz-input-group
        [nzPrefix]="searchPrefix"
        [nzSuffix]="searchSuffix"
        style="height: 40px"
      >
        <ng-template #searchPrefix
          ><span
            nz-icon
            nzType="search"
            nzTheme="outline"
            style="color: #d8c6bf"
          ></span
        ></ng-template>
        <ng-template #searchSuffix
          ><span
            *ngIf="common"
            (click)="common = ''"
            nz-icon
            nzType="close-circle"
            nzTheme="fill"
            style="font-size: 12px; cursor: pointer; color: rgb(172, 170, 170)"
          ></span
        ></ng-template>

        <input
          nz-input
          [nzAutocomplete]="auto"
          placeholder="{{ 'placeHolderSearch' | translate }}"
          [(ngModel)]="common"
          (keyup)="search($event)"
          (focus)="onInputFocus()"
          (blur)="onInputBlur()"
        />

        <nz-autocomplete #auto [nzDefaultActiveFirstOption]="false">
          <nz-auto-option
            *ngFor="let option of optionsComplete"
            [nzValue]="option"
            >{{ option }}</nz-auto-option
          >
        </nz-autocomplete>
      </nz-input-group> -->
    </div>
    <div style="display: flex;">
      <div nz-col>
        <button
          style="color: #01aba8"
          nz-button
          nzType="text"
          (click)="addConfigTable()"
          class="mb-24"
        >
          <span nz-icon nzType="plus-circle" nzTheme="outline"></span>
          {{ "add.btn" | translate }}
        </button>
      </div>
      <div nz-col>
        <button
          style="color: #01aba8"
          nz-button
          nzType="text"
          (click)="openPopupDeleteList()"
          class="mb-24"
        >
          <span nz-icon nzType="delete" nzTheme="outline"></span>
          {{ "btn.delete" | translate }}
        </button>
      </div>
  
      <div nz-col>
        <nz-row nzJustify="end">
          <button
            class="mb-24"
            style="color: #01aba8"
            nz-button
            (click)="configColumn()"
            nzType="text"
            nz-tooltip="{{ 'btn.choose' | translate }}"
            nz-dropdown
            nzTrigger="click"
            [nzDropdownMenu]="configColumns"
          >
            <img src="./assets/icons/Block.svg">
          </button>
  
          <nz-dropdown-menu #configColumns="nzDropdownMenu">
            <ul nz-menu>
              <ng-container *ngFor="let column of columns">
                <li nz-menu-item>
                  <label
                    nz-checkbox
                    [(ngModel)]="column.localCheck"
                    (ngModelChange)="changeColumn()"
                    >{{ column.keyTitle | translate }}</label
                  >
                </li>
              </ng-container>
            </ul>
          </nz-dropdown-menu>
        </nz-row>
      </div>
    </div>
  </div>

  <nz-table
    nzBordered
    nzShowPagination="false"
    [nzScroll]="{ x: 'auto', y: '800px' }"
    [nzData]="listFunction"
    #MachineTable
    [nzSize]="'small'"
  >
    <thead class="color-header-row">
      <tr>
        <th></th>
        <th></th>
        <ng-container *ngFor="let column of columns; let i = index">
          <ng-container *ngIf="column.localCheck">
            <th
              nz-resizable
              [nzWidth]="column.width"
              (nzResize)="onResize($event, i)"
              [nzAlign]="'center'"
              (nzSortOrderChange)="customSortFunction($event, column.keyName)"
            >
              <div class="editable-cell">
                {{ column.keyTitle | translate}}
                <nz-resize-handle nzDirection="right">
                  <div class="resize-trigger"></div>
                </nz-resize-handle>
              </div>
              
            </th>
          </ng-container>
        </ng-container>
        <th nzWidth="86px" nzAlign="center" [nzRight]="true">
          {{ "Thao tác" | translate }}
        </th>
      </tr>
    </thead>
    <tbody class="striped-tr" cdkDropList (cdkDropListDropped)="drop($event)">
      <ng-container *ngFor="let infor of listFunction; let i = index">
        <tr cdkDrag cdkDragLockAxis="y">
          <td cdkDragHandle>
            <img src="./assets/icons/changePositionRow.svg">
          </td>
          <td [nzExpand]="expandSet.has(infor.id)" (nzExpandChange)="onExpandChange(infor.id, $event)"></td>
          <ng-container *ngFor="let column of columns">
            <ng-container *ngIf="column.localCheck">
              <ng-container [ngSwitch]="column.keyName">
                <ng-container *ngSwitchCase="'status'">
                  <td>
                    <div [ngSwitch]="infor[column.keyName]" nzAlign="center">
                      <div
                        class="border-element bordered-element__status_1"
                        *ngSwitchCase="'1'"
                      >
                        {{ "Hoạt động" | translate }}
                      </div>
                      <div
                        class="border-element bordered-element__status_2"
                        *ngSwitchCase="'0'"
                      >
                        {{ "Ngừng hoạt động" | translate }}
                      </div>
                    </div>
                  </td>
                </ng-container>
                <ng-container *ngSwitchDefault>
                  <ng-container *ngIf="column.dataType != dataType.NUMBER && column.dataType != dataType.DATE_TIME && column.dataType != dataType.BOOLEAN">
                    <td>
                      {{ infor[column.keyName] }}
                    </td>
                  </ng-container>
                  <ng-container *ngIf="column.dataType == dataType.NUMBER">
                    <td class="fn-text-al-right">
                        {{ infor[column.keyName] | number : "1.0-0" }}
                    </td>
                  </ng-container>
                  <ng-container *ngIf="column.dataType == dataType.DATE_TIME">
                    <td class="fn-text-al-right">
                      {{ infor[column.keyName] | date: 'dd-MM-yyyy' }}
                    </td>
                  </ng-container>
                  <ng-container *ngIf="column.dataType == dataType.BOOLEAN">
                    <td class="fn-text-al-center">
                      <label nz-checkbox [(ngModel)]="infor[column.keyName]"></label>
                    </td>
                  </ng-container>
                </ng-container>
              </ng-container>
            </ng-container>
          </ng-container>
          <td nzAlign="center" [nzRight]="true">
            <div class="fn-css-action-grid">
              <button
                nz-button
                nzType="link"
                (click)="editMachine(infor)"
                nz-tooltip="{{ 'btn.edit' | translate }}"
              >
                <img src="./assets/icons/Edit-VNT.svg">
              </button>
              <button
                nz-button
                nzType="link"
                (click)="deleteMachine(infor)"
                nz-tooltip="{{ 'btn.delete' | translate }}"
              >
              <img width="16px" height="16px" src="./assets/icons/Delete-VNT.svg">
              </button>
            </div>
          </td>
        </tr>
        <tr [nzExpand]="expandSet.has(infor.id)">
            <nz-table #nzTable [nzData]="listFunction" nzTableLayout="fixed" nzShowPagination="false">
                <thead>
                  <tr>
                    <th>Mã chức năng</th>
                    <th>Tên chức năng</th>
                    <th>Mô tả</th>
                    <th nzWidth="86px">Thao tác</th>
                  </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ABC</td>
                        <td>ABC</td>
                        <td>ABC</td>
                        <td nzAlign="center" [nzRight]="true">
                            <div class="fn-css-action-grid">
                              <button
                                nz-button
                                nzType="link"
                                nz-tooltip="{{ 'btn.edit' | translate }}"
                              >
                                <img src="./assets/icons/Edit-VNT.svg">
                              </button>
                              <button
                                nz-button
                                nzType="link"
                                nz-tooltip="{{ 'btn.delete' | translate }}"
                              >
                              <img width="16px" height="16px" src="./assets/icons/Delete-VNT.svg">
                              </button>
                            </div>
                          </td>
                    </tr>
                </tbody>
            </nz-table>
        </tr>
      </ng-container>
    </tbody>
  </nz-table>

  <app-pagination
    *ngIf="total"
    [currentPage]="pageNumber"
    [currentSize]="pageSize"
    [total]="total"
    (emitPage)="getData($event)"
  >
  </app-pagination>
</nz-card>

<app-popup-add-config-table
  *ngIf="isvisibleAdd"
  (isvisibleChange)="addColumnConfirm()"
  [(isvisible)]="isvisibleAdd"
>
</app-popup-add-config-table>

<app-popup-delete
  *ngIf="isvisibleDelete"
  (delete)="deleteConfirm($event)"
  [title]="'Xoá ' + inforTable.label"
  [tableName]="inforTable.label"
  [code]="currentMachine[columnKey]"
  [(isvisible)]="isvisibleDelete"
>
</app-popup-delete>

<app-add-column
  *ngIf="isvisibleAddColumn"
  [entryType]="6"
  [(isvisible)]="isvisibleAddColumn"
  (isvisibleChange)="addColumnConfirm()"
></app-add-column>
<!-- <app-popup-import *ngIf="isvisibleImport" [entityType]="6" [formData]="listMachineTemplate"
  [(isvisible)]="isvisibleImport" (import)="importConfirm($event)"></app-popup-import> -->

<app-popup-copy
  *ngIf="isvisibleCopy"
  (copy)="submitCopy()"
  [(isvisible)]="isvisibleCopy"
>
</app-popup-copy>
